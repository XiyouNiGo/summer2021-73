# 问题记录

## 第二周

+ rebase删除了原有commit。

+ 项目结构：

  ![image-20210715164456638](C:\Users\NiGo\AppData\Roaming\Typora\typora-user-images\image-20210715164456638.png)

  ![image-20210715164517569](C:\Users\NiGo\AppData\Roaming\Typora\typora-user-images\image-20210715164517569.png)

+ iSulad如何对接K8S：

  ![image-20210715164653478](C:\Users\NiGo\AppData\Roaming\Typora\typora-user-images\image-20210715164653478.png)

+ RootFS到底是啥：

  ![image-20210715212814216](C:\Users\NiGo\AppData\Roaming\Typora\typora-user-images\image-20210715212814216.png)

+ ! [rejected]   master -> master (non-fast-forward)

+ images指定特定镜像名应该怎么实现

+ 减少圈复杂度

+ isulad不支持多重参数，例如：docker images --filter=reference='busy*:uclibc' --filter=reference='busy*:glibc'

# 第三周

+ images指定特定镜像名通过将指定的镜像名转化成--filter=reference='image_name:*'合理吗

+ client中对request采用栈内存，对respond却采用动态内存，原因是什么？是否可以修改来提高项目性能。

+ 关于一些代码缩写不太懂，比如shim（好像是容器里的东西）、rest（是restful风格吗）、client回调函数中的ops、cc（错误码？）、bim、mock

+ 函数util_check_inherited_exclude_fds的作用？

+ 为什么docker需要cache id？

+ SizeRw int64 The size of files that have been created or changed by this container.

+ SizeRootFs int64 The total size of all the files in this container.

+ https://docs.docker.com/engine/api/v1.25/#operation/ContainerList

+ GetContainerLayerSize流程：

  + 根据container-id获取读写层（containers_store_get）

  + 从读写层计算SizeRw大小

    ```
    // Size represents the size of the writable layer
    // as calculated by the total size of the files
    // changed in the mutable layer.
    ```

  + 获取该读写层的父层

    ```
    // Parent returns the layer which the writable
    // layer was created from.
    ```

  + SizeRootFs：父层大小 + SizeRw

    ```
    // Size returns the size of the entire layer chain. The size
    // is calculated from the total size of all files in the layers.
    ```

+ 结构体：container_t、storage_rootfs、db_image

+ 函数：rootfs_store_get_rootfs、db_read_image

+ 文件：src/daemon/modules/image/oci/storage/rootfs_store/rootfs_store.c

+ layerid（digest）、chainid、imageid、diffid具体含义。

  + layerID -> diffID -> chainID -> cacheID

+ roLayer:/var/lib/docker/image/overlay2/layerdb/sha256

+ mountLayer:/var/lib/docker/image/overlay2/layerdb/mount
+ chainid：/var/lib/docker/image/overlay2/layerdb/sha256/
+ layerID和diffID的对应关系在diffid-by-digest和v2metadata-by-diffid
+ RootFs中的是diffID
+ cacheID主要存在于/var/lib/docker/overlay2/<cache-id>
+ Image ID是在本地由Docker根据镜像的描述文件计算的，并用于imagedb的目录名称

## 容器创建之daemon

container_create_cb -> do_image_create_container_roofs_layer -> im_prepare_container_rootfs -> oci_prepare_rf -> storage_rootfs_create

